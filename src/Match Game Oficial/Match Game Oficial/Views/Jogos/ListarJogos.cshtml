<link rel="stylesheet" href="~/css/ListarJogos.css" asp-append-version="true" />

@model IEnumerable<Match_Game_Oficial.Models.GameView>

@{
    ViewData["Title"] = "ListarJogos";
}

<div id="js-preloader" class="js-preloader loaded">

    <div class="preloader-inner">

        <span class="dot"></span>
        <div class="dots">
            <span></span>
            <span></span>
            <span></span>

        </div>
    </div>
</div>


<div class="container">
    <div class="row">
        <div class="col-lg-12">
            <div class="most-popular">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="heading-section">
                            <h4 class="text-center">JOGOS RECOMENDADOS PARA VOCÊ</h4>
                            <p class="text-center">Confira abaixo a lista dos jogos que foram recomendados para você.</p>
                        </div>
                        <div class="row gameList">
                        </div>

                        <div class="col-lg-12">
                            <div class="main-button">
                                <a href="javascript:void(0)">Mais Jogos</a>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    var userName = "@User.Identity.Name";

    document.addEventListener('click', function (event) {

        if (event.target.classList.contains('favorite-button')) {
            // Verificar se o usuário está logado antes de prosseguir
            if (!userName) {
                alert("Por favor, faça login para favoritar jogos.");
                return; // Impede a execução do restante do código
            }

            const gameContainer = event.target.closest('.item');
            const gameName = gameContainer.querySelector('.game-name').textContent;

            // Função para verificar se o jogo já está favoritado
            function isGameAlreadyFavorited(gameName, userName) {
                const favoritosKey = `favoritos_${userName}`;
                let favoriteGamesList = JSON.parse(localStorage.getItem(favoritosKey)) || [];
                return favoriteGamesList.some(game => game.name === gameName);
            }

            // Verificar se o jogo já está na lista de favoritos
            if (isGameAlreadyFavorited(gameName, userName)) {
                alert(`${gameName} já foi favoritado`);
                return;
            }
            alert(`${gameName} foi adicionado à lista de favoritos!`);

            const gameRating = gameContainer.querySelector('.rating').textContent;
            const gameReleased = gameContainer.querySelector('.date').textContent;

            const favoriteGame = {
                name: event.target.parentNode.querySelector('.game-name').textContent,
                released: event.target.parentNode.querySelector('.date').textContent,
                rating: event.target.parentNode.querySelector('.rating').textContent,
                background_image: event.target.parentNode.querySelector('img').src,
                parent_platforms: event.target.parentNode.querySelector('.platforms').textContent,
            };

            const favoritosKey = `favoritos_${userName}`;

            let favoriteGamesList = JSON.parse(localStorage.getItem(favoritosKey)) || [];
            favoriteGamesList.push(favoriteGame);
            localStorage.setItem(favoritosKey, JSON.stringify(favoriteGamesList));
        }
    });
</script>

<div class="TelaSemlogin">
    <span>  É necessário estar Logado para acessar esta página!
            Realize login e tente novamente.
    </span>
</div>

<script src="https://kit.fontawesome.com/fe8eb85698.js" crossorigin="anonymous"></script>


